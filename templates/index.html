from flask import Flask, render_template, request
import pandas as pd
import os

app = Flask(__name__)

@app.route('/', methods=['GET', 'POST'])
def index():
    results = []
    if request.method == 'POST':
        product_name = request.form['product_name']
        keywords = request.form['keywords']
        usp = request.form['usp']
        location = request.form['location']
        cta = request.form['cta']

        results = [
            {
                'Headline 1': f"{product_name} Thi·∫øt K·∫ø Ri√™ng",
                'Headline 2': f"{usp[:30]}",
                'Headline 3': f"{cta[:30]}",
                'Description 1': f"{product_name} t·∫°i {location}. {usp}.",
                'Description 2': f"{cta}. Li√™n h·ªá ngay!"
            },
            {
                'Headline 1': f"{keywords.split(',')[0].strip().capitalize()} Gi√° T·ªët",
                'Headline 2': f"Giao h√†ng {location}",
                'Headline 3': f"{cta[:30]}",
                'Description 1': f"T√¨m hi·ªÉu v·ªÅ {product_name} v·ªõi {usp}.",
                'Description 2': f"{cta}. Mi·ªÖn ph√≠ t∆∞ v·∫•n."
            }
        ]

    return render_template('index.html', results=results)

@app.route('/download', methods=['POST'])
def download():
    data = request.form.get('data')
    df = pd.read_json(data)
    df.to_csv('ads_output.csv', index=False)
    return "<h3>ƒê√£ xu·∫•t ra file ads_output.csv th√†nh c√¥ng!</h3>"

if __name__ == '__main__':
    if not os.path.exists('templates'):
        os.makedirs('templates')

    with open('templates/index.html', 'w', encoding='utf-8') as f:
        f.write('''
<!DOCTYPE html>
<html>
<head>
    <title>Google Ads Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 40px; background: #f8f9fa; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="mb-4 text-center">üß† Tool Sinh M·∫´u Qu·∫£ng C√°o Google Ads</h2>
        <form method="POST">
            <div class="mb-3">
                <label class="form-label">T√™n s·∫£n ph·∫©m/d·ªãch v·ª•:</label>
                <input type="text" name="product_name" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">T·ª´ kho√° ch√≠nh (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y):</label>
                <input type="text" name="keywords" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">∆Øu ƒëi·ªÉm n·ªïi b·∫≠t (USP):</label>
                <textarea name="usp" class="form-control" required></textarea>
            </div>
            <div class="mb-3">
                <label class="form-label">Khu v·ª±c nh·∫Øm ƒë·∫øn:</label>
                <input type="text" name="location" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Call-to-Action (CTA):</label>
                <input type="text" name="cta" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary">üöÄ Sinh m·∫´u qu·∫£ng c√°o</button>
        </form>

        {% if results %}
            <hr>
            <h4 class="mt-4">üéØ K·∫øt qu·∫£ ƒë·ªÅ xu·∫•t:</h4>
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead class="table-light">
                        <tr>
                            <th>Headline 1</th>
                            <th>Headline 2</th>
                            <th>Headline 3</th>
                            <th>Description 1</th>
                            <th>Description 2</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in results %}
                        <tr>
                            <td>{{ row['Headline 1'] }}</td>
                            <td>{{ row['Headline 2'] }}</td>
                            <td>{{ row['Headline 3'] }}</td>
                            <td>{{ row['Description 1'] }}</td>
                            <td>{{ row['Description 2'] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>
</body>
</html>
''')

    app.run(debug=True, port=5000)
